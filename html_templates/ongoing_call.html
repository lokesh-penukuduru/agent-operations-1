<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Call Details</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #e8f0fe;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            position: relative;
        }

        .container {
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            width: 750px;
            height: 550px;
            text-align: center;
            position: relative;
        }

        .top-bar {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-bottom: 20px;
        }

        .settings {
            position: relative;
        }

        .settings-icon {
            width: 24px;
            height: 24px;
            cursor: pointer;
        }

        .settings-menu {
            display: none;
            position: absolute;
            top: 30px;
            left: 0;
            background-color: #fff;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            z-index: 1;
            width: 100px;
        }

        .settings-menu.show {
            display: block;
        }

        .settings-menu a {
            display: block;
            padding: 10px;
            text-decoration: none;
            color: #333;
        }

        .settings-menu a:hover {
            background-color: #f0f2f5;
        }

        .agent-name {
            font-weight: bold;
            font-size: 18px;
            color: #333;
        }
        
        .call-details {
            margin-top: 70px;
            margin-bottom: 20px;
        }

        .call-details h2 {
            font-size: 26px;
            color: #333;
        }

        .call-details .customer-name, .phone-number, .call-duration {
            font-weight: bold;
        }

        .customer-info {
            margin-bottom: 10px;
            font-size: 14px;
        }

        .call-actions {
            padding: 10px;
            display: flex;
            justify-content: center;
            margin-top: 70px;
            margin-bottom: 30px;
        }

        .call-actions button {
            width: 140px;
            height: 50px;
            padding: 18px 4px;
            margin: 0 25px;
            border: none;
            border-radius: 4px;
            font-size: 18px;
            cursor: pointer;
            transition: transform 0.2s, background-color 0.2s;
        }

        .call-actions .hold, .transfer, .conference {
            background-color: #0e3210;
            color: white;
        }

        .enlarged {
            background-color: #2e0401 !important;
            transform: scale(1.3); /* Enlarges the button */
        }

        .call-actions button:hover {
            transform: scale(1.2);
        }

        .call-actions button:active {
            transform: scale(1);
        }

        .end-button {
            margin-top: 30px !important;
            margin-bottom: 40px;
            padding: 12px 24px;
            background-color: #f44336;
            color: white;
            font-size: 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .end-button:hover {
            background-color: #d32f2f;
        }

        .agents-list {
            display: none;
            position: absolute;
            background-color: #fff;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            z-index: 1;
            width: 200px;
            max-height: 300px;
            overflow-y: auto;
            font-size: 18px;
        }

        .agents-list.open {
            display: block;
        }

        .agents-list button {
            display: block;
            width: 100%;
            padding: 10px;
            font-size: 16px;
            text-align: left;
            border: none;
            background-color: transparent;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .agents-list option {
            padding: 18px;
            font-size: 20px;
        }

        .agents-list button:hover {
            background-color: #f0f0f0;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgb(0, 0, 0);
            background-color: rgba(0, 0, 0, 0.4);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 600px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            text-align: center;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        .agents-list-modal {
            max-height: 200px;
            overflow-y: auto;
            margin: 10px 0;
            padding: 0;
            list-style: none;
        }

        .agents-list-item {
            padding: 10px;
            font-size: 18px;
            cursor: pointer;
        }

        .agents-list-item:hover {
    background-color: #f0f0f0;
}

        .confirm-button {
            background-color: #4CAF50;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 20px;
        }

        .confirm-button:hover {
            background-color: #45a049;
        }

        /* to blink the duration when call is in hold */
        @keyframes blink {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0;
            }
        }

        .blink {
            animation: blink 1s infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="top-bar">
            <div class="settings">
                <img src="{{ url_for('static', filename='settings-icon.png') }}" alt="Settings" class="settings-icon" id="settings-icon">
                <div class="settings-menu" id="settings-menu">
                    <a href="#">extCallId</a>
                    <a href="#">extension</a>
                    <a href="#">segment</a>
                </div>
            </div>
            <div class="agent-name">
                {% if isConferenceCall %}
                    {{ conferenceAgents }}
                {% else %}
                    {{ currentAgent }}
                {% endif %}
            </div>
        </div>
        <div class="call-details">
            <h2>Customer Name : <span class="customer-name">Customer_Name</span></h2>
            <h2>Phone Number : <span class="phone-number">+91 7812345678</span></h2>
            <h2>Call Duration : <span id="call-duration">00:00</span></h2>
        </div>
        <div class="call-actions">
            <button id="hold-resume" class="hold" onclick="toggleHoldResume(this)">HOLD</button>
            <button id="transfer-button" class="transfer" onclick="openModal('transfer-modal')">TRANSFER</button>
            <button id="conference-button" class="conference" onclick="openModal('conference-modal')">CONFERENCE</button>
        </div>

        <!-- Transfer Modal -->
        <div id="transfer-modal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal('transfer-modal')">&times;</span>
                <h2>Select Agent to Transfer Call</h2>
                <form id="transfer-call-form" action="/transferCall" method="post">
                    <ul id="agents-list" class="agents-list-modal">
                        {% for agent in availableAgents %}
                            <li class="agents-list-item" onclick="selectAgent('{{ agent }}', this)">{{ agent }}</li>
                        {% endfor %}
                    </ul>
                    <input type="hidden" id="selected-transfer-agent" name="agent">
                    <button type="submit" class="confirm-button">Transfer call</button>
                </form>
            </div>
        </div>


        <!-- Conference Modal -->
        <div id="conference-modal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal('conference-modal')">&times;</span>
                <h2>Select Agent to Add to Conference</h2>
                <form id="conference-call-form" action="/conferenceCall" method="post">
                    <ul id="conference-agents-list" class="agents-list-modal">
                        {% for agent in availableAgents %}
                            <li class="agents-list-item" onclick="selectAgent('{{ agent }}', this)">{{ agent }}</li>
                        {% endfor %}
                    </ul>
                    <input type="hidden" id="selected-conference-agent" name="agent">
                    <button type="submit" class="confirm-button">Add to Conference</button>
                </form>
            </div>
        </div>


        <!-- Call actions section -->
        <div class="call-actions">
            <form id="end-call-form" action="/endCall" method="post">
                <input type="hidden" id="call-duration-input" name="callDuration">
                <button type="submit" class="end-button">END</button>
            </form>
        </div>

    </div>

    <script>

        let startTime = new Date();
        let isOnHold = false;
        let pausedDuration = 0;
        let holdStartTime = null;

        document.addEventListener("DOMContentLoaded", function() {
            const settingsIcon = document.getElementById('settings-icon');
            const settingsMenu = document.getElementById('settings-menu');

            // Toggle settings menu visibility on settings icon click
            settingsIcon.addEventListener('click', function() {
                settingsMenu.classList.toggle('show');
            });

            // Close the settings menu if user clicks outside of it or clicks an option
            document.addEventListener('click', function(event) {
                if (!settingsMenu.contains(event.target) && event.target !== settingsIcon) {
                    settingsMenu.classList.remove('show');
                }
            });

            // Close the settings menu when clicking on an option
            settingsMenu.addEventListener('click', function(event) {
                if (event.target.tagName === 'A') {
                    settingsMenu.classList.remove('show');
                }
            });
        });

        function updateCallDuration() {

            if (isOnHold) return;
            let currentTime = new Date();
            let elapsedTime = new Date(currentTime - startTime - pausedDuration);

            let hours = elapsedTime.getUTCHours();
            let minutes = elapsedTime.getUTCMinutes();
            let seconds = elapsedTime.getUTCSeconds();

            let formattedTime = (hours > 0)
                ? `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`
                : `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

            // let hours = Math.floor(elapsedTime / 3600000); // Convert elapsed time to hours
            // let minutes = Math.floor((elapsedTime % 3600000) / 60000); // Convert the remainder to minutes
            // let seconds = Math.floor((elapsedTime % 60000) / 1000); // Convert the remainder to seconds


            // let formattedHours = hours.toString().padStart(2, '0');
            // let formattedMinutes = minutes.toString().padStart(2, '0');
            // let formattedSeconds = seconds.toString().padStart(2, '0');

            // document.getElementById('call-duration').textContent = `${formattedHours}:${formattedMinutes}:${formattedSeconds}`;
            // document.getElementById('call-duration-input').value = `${formattedHours}:${formattedMinutes}:${formattedSeconds}`;
            document.getElementById('call-duration').textContent = formattedTime;
            document.getElementById('call-duration-input').value = formattedTime;
        }

        setInterval(updateCallDuration, 1000);

        function toggleHoldResume(button) {

            const durationElement = document.getElementById('call-duration');

            if (button.textContent === "HOLD") {
                button.textContent = "RESUME";
                button.classList.add("enlarged");
                holdStartTime = new Date();
                isOnHold = true;
                durationElement.classList.add('blink');
            } else {
                button.textContent = "HOLD";
                button.classList.remove("enlarged");
                pausedDuration += new Date() - holdStartTime;
                holdStartTime = null;
                isOnHold = false;
                durationElement.classList.remove('blink');
            }
        }

        function openModal(modalId) {
            var modal = document.getElementById(modalId);
            modal.style.display = "block";
        }

        function closeModal(modalId) {
            var modal = document.getElementById(modalId);
            modal.style.display = "none";
        }

        function confirmTransfer() {
            // Implement transfer logic here
            closeModal('transfer-modal');
        }

        let selectedAgentElement = null;

        function selectAgent(agentName, element) {
            // Remove the highlight from the previously selected agent
            if (selectedAgentElement) {
                selectedAgentElement.style.backgroundColor = '';
            }

            // Highlight the clicked agent
            element.style.backgroundColor = '#f0f0f0';
            selectedAgentElement = element;

            // Set the selected agent value in the hidden input field
            // document.getElementById('selected-agent').value = agentName;
            if (document.getElementById('transfer-modal').style.display === 'block') {
                document.getElementById('selected-transfer-agent').value = agentName;
            } else if (document.getElementById('conference-modal').style.display === 'block') {
                document.getElementById('selected-conference-agent').value = agentName;
            }
        }

        // Close the modal when the user clicks outside of it
        window.onclick = function(event) {
            let modal = document.getElementById('transfer-modal');
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = "none";
        }


    </script>
</body>
</html>
